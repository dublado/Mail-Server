machine:
  services:
    - docker
dependencies:
  override:
    - docker build --no-cache -t mail-base mail-base/
    - docker build -t imap-server:2.1.8 dovecot/
test:
  override:
    # test imap-server
    - docker run --name mail-base mail-base
    - docker run -v /srv --name mailvol ubuntu:14.04
    - docker run -d --restart=always --volumes-from mail-base -e USER=p08tf1X -e PASS=p@ssw0Rd -e LOG_TOKEN=8397b752-123f-4d10-95b1-76f267102a7b --name imap-server -p 25:25 -p 587:587 -p 143:143 imap-server:2.1.8

    # test imap-server
    - docker logs imap-server | grep "p08tf1X:p@ssw0Rd"
    # test logentries sample key
    - docker logs imap-server | grep "8397b752-123f-4d10-95b1-76f267102a7b"